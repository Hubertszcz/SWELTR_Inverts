---
title: "Abundance"
output: 
  html_document:
    toc: yes
    toc_float: yes
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Total Abundance 

```{r, echo=FALSE, message = FALSE, warning = FALSE}
library(vegan)
library(ggplot2)
library("dplyr")
library(tidyr)

soil.data <- read.csv("C:/Users/USER/Desktop/Inverts/Stats for invert project/Output data/soil.data.csv")

Date <- c("Dec", "Jan", "Feb", "Mar", "May", "June", "July", "Aug", "Sept","Oct")


ggplot(soil.data, aes(x=Date,y=abundance, fill=Plot.Type)) + geom_boxplot(size=1) + scale_fill_manual(values = c("royalblue1", "tomato1")) +
  theme_minimal() + labs(y= "Total abundance", x = "Sampling Month")+
  #annotate("rect", xmin=-Inf, xmax= 1.5, ymin = -Inf, ymax = Inf, alpha = 0.2, fill = "blue") +
  annotate("rect", xmin=1.5, xmax= 4.5, ymin = -Inf, ymax = Inf, alpha = 0.2, fill = "orange") +
  #annotate("rect", xmin=4.5, xmax=Inf, ymin = -Inf, ymax = Inf, alpha = 0.2, fill = "blue")+
  scale_x_discrete(labels= Date) + theme(text=element_text(family="Arial"))+
  theme(
    legend.position = "none",
    legend.justification = c("right", "bottom"),
    legend.box.just = "right",
    legend.margin = margin(3, 3, 3, 3))
```


## Abundance differences based on trophic level

```{r, echo=FALSE, message = FALSE, warning = FALSE}
soil.abundance3 <- read.csv("C:/Users/USER/Desktop/Inverts/Stats for invert project/Output data/soil.abundance3.csv")

library(vegan)
library(ggplot2)
library("dplyr")
library(tidyr)
library(lme4)
library(car)
require(glmmTMB)
require(DHARMa)
#library(effects)
library("gridExtra")  
library(grid)
library(ggeffects)

xaxis <- c(" ", " ")

```


### Detritivores
```{r, echo=FALSE, message = FALSE, warning = FALSE}

Detritivores <- glm(Decomposers ~ Avg..Soil.moisture * Plot.Type, family = poisson, data=soil.abundance3)

Detritivores.effects <- ggpredict(Detritivores, terms = c("Avg..Soil.moisture", "Plot.Type"))


#effects plot
Detritivores.effects.plot <- ggplot(Detritivores.effects, aes(x = x, y = predicted, colour = group)) +
  geom_ribbon(aes(ymin = conf.low, ymax = conf.high, fill=group), alpha = .1) +
  geom_line(size=1.5) + theme_minimal()+
  labs(x = "% Moisture", y = expression(paste("Pred count ", (kg^-1))), size=10)+ theme(plot.title = element_text(hjust = 0.5)) + 
  theme(legend.position="none",legend.text=element_text(size=15),legend.direction='horizontal',plot.title = element_text(hjust=0.5),text=element_text(family="Arial"))+
  theme(text=element_text(family="Arial"))

#violin plot
Detritivores.violin.plot <- ggplot(soil.abundance3, aes(x = Plot.Type, y = Decomposers, color = Plot.Type, group = Plot.Type)) + geom_violin(trim=FALSE, size=1)+
  theme_minimal()+ labs(y= expression(paste("count ", (kg^-1))), x = "")+
  geom_boxplot(width=0.1, size=1) + scale_color_hue(direction = -1) +
  theme(plot.title = element_text(hjust = 0.5)) + stat_summary(fun=mean, geom="point", size=1) + stat_summary(fun.data = mean_se, geom = "errorbar", aes(width=.02, size=.5))+
  theme(legend.position="none",legend.text=element_text(size=15),legend.direction='horizontal',plot.title = element_text(hjust=0.5),text=element_text(family="Arial"))+
  scale_x_discrete(labels= xaxis) +
  #annotate("text", x = 2, y = 68, label = "Warming > 0.05", size=20, family="Arial")+
  #annotate("text", x = 2, y = 65, label = "Soil Moisture < 0.05", size=20, family="Arial")+
  #annotate("text", x = 2, y = 62, label = "Warming:Soil Moisture < 0.05", size=20, family="Arial")+
  theme(text=element_text(family="Arial"))

grid.arrange(Detritivores.violin.plot, Detritivores.effects.plot, ncol = 2, top = grid::textGrob("Detritivores", x = 0, hjust = 0, gp=gpar(fontfamily="Arial")))
```


### Fungivores
```{r, echo=FALSE, message = FALSE, warning = FALSE}

Fungivores <- glm(Fungivores ~ Avg..Soil.moisture * Plot.Type, family = poisson, data=soil.abundance3)

Fungivores.effects <- ggpredict(Fungivores, terms = c("Avg..Soil.moisture", "Plot.Type"))

#effects plot
Fungivores.effects.plot <- ggplot(Fungivores.effects, aes(x = x, y = predicted, colour = group)) +
  geom_ribbon(aes(ymin = conf.low, ymax = conf.high, fill=group), alpha = .1) +
  geom_line(size=1.5) + theme_minimal()+
  labs(x = "% Moisture", y = expression(paste("Pred count ", (kg^-1))), size=10)+ theme(plot.title = element_text(hjust = 0.5)) + 
  theme(legend.position="none",legend.text=element_text(size=15),legend.direction='horizontal',plot.title = element_text(hjust=0.5),text=element_text(family="Arial"))+
  theme(text=element_text(family="Arial"))

#violin plot
Fungivores.violin.plot <- ggplot(soil.abundance3, aes(x = Plot.Type, y = Fungivores, color = Plot.Type, group = Plot.Type)) + geom_violin(trim=FALSE, size=1)+
  theme_minimal()+ labs(y= expression(paste("count ", (kg^-1))), x = "")+
  geom_boxplot(width=0.1, size=1) + scale_color_hue(direction = -1) +
  theme(plot.title = element_text(hjust = 0.5)) + stat_summary(fun=mean, geom="point", size=1) + stat_summary(fun.data = mean_se, geom = "errorbar", aes(width=.02, size=.5))+
  theme(legend.position="none",legend.text=element_text(size=15),legend.direction='horizontal',plot.title = element_text(hjust=0.5),text=element_text(family="Arial"))+
  scale_x_discrete(labels= xaxis) +
  #annotate("text", x = 1, y = 410, label = "Warming < 0.05", size=20, family="Arial")+ 
  #annotate("text", x = 1, y = 390, label = "Soil Moisture < 0.05", size=20, family="Arial")+ 
  #annotate("text", x = 1, y = 370, label = "Warming:Soil Moisture < 0.05", size=20, family="Arial")+
  theme(text=element_text(family="Arial"))

grid.arrange(Fungivores.violin.plot, Fungivores.effects.plot, ncol = 2, top = grid::textGrob("Fungivores", x = 0, hjust = 0, gp=gpar(fontfamily="Arial")))
```


### Herbivores
```{r, echo=FALSE, message = FALSE, warning = FALSE}

Herbivores <- glm(Herbivores ~ Avg..Soil.moisture * Plot.Type, family = poisson, data=soil.abundance3)

Herbivores.effects <- ggpredict(Herbivores, terms = c("Avg..Soil.moisture", "Plot.Type"))

#effects plot
Herbivores.effects.plot <- ggplot(Herbivores.effects, aes(x = x, y = predicted, colour = group)) +
  geom_ribbon(aes(ymin = conf.low, ymax = conf.high, fill=group), alpha = .1) +
  geom_line(size=1.5) + theme_minimal()+
  labs(x = "% Moisture", y = expression(paste("Pred count ", (kg^-1))), size=10)+ theme(plot.title = element_text(hjust = 0.5)) + 
  theme(legend.position="none",legend.text=element_text(size=15),legend.direction='horizontal',plot.title = element_text(hjust=0.5),text=element_text(family="Arial"))+
  theme(text=element_text(family="Arial"))

#violin plot
Herbivores.violin.plot <- ggplot(soil.abundance3, aes(x = Plot.Type, y = Herbivores, color = Plot.Type, group = Plot.Type)) + geom_violin(trim=FALSE, size=1)+
  theme_minimal()+ labs(y= expression(paste("count ", (kg^-1))), x = "")+
  geom_boxplot(width=0.1, size=1) + scale_color_hue(direction = -1) +
  theme(plot.title = element_text(hjust = 0.5)) + stat_summary(fun=mean, geom="point", size=1) + stat_summary(fun.data = mean_se, geom = "errorbar", aes(width=.02, size=.5))+
  theme(legend.position="none",legend.text=element_text(size=15),legend.direction='horizontal',plot.title = element_text(hjust=0.5),text=element_text(family="Arial"))+
  scale_x_discrete(labels= xaxis) +
  #annotate("text", x = 1, y = 147, label = "Warming < 0.05", size=20, family="Arial")+ 
  #annotate("text", x = 1, y = 140, label = "Soil Moisture < 0.05", size=20, family="Arial")+ 
  #annotate("text", x = 1, y = 133, label = "Warming:Soil Moisture < 0.05", size=20, family="Arial")+
  theme(text=element_text(family="Arial"))

grid.arrange(Herbivores.violin.plot, Herbivores.effects.plot, ncol = 2, top = grid::textGrob("Herbivores", x = 0, hjust = 0, gp=gpar(fontfamily="Arial")))
```

### Predators
```{r, echo=FALSE, message = FALSE, warning = FALSE}

Predators <- glm(Predators ~ Avg..Soil.moisture * Plot.Type, family = poisson, data=soil.abundance3)

Predators.effects <- ggpredict(Predators, terms = c("Avg..Soil.moisture", "Plot.Type"))

#effects plot
Predators.effects.plot <- ggplot(Predators.effects, aes(x = x, y = predicted, colour = group)) +
  geom_ribbon(aes(ymin = conf.low, ymax = conf.high, fill=group), alpha = .1) +
  geom_line(size=1.5) + theme_minimal()+
  labs(x = "% Moisture", y = expression(paste("Pred count ", (kg^-1))), size=10)+ theme(plot.title = element_text(hjust = 0.5)) + 
  theme(legend.position="none",legend.text=element_text(size=15),legend.direction='horizontal',plot.title = element_text(hjust=0.5),text=element_text(family="Arial"))+
  theme(text=element_text(family="Arial"))

#violin plot
Predators.violin.plot <- ggplot(soil.abundance3, aes(x = Plot.Type, y = Predators, color = Plot.Type, group = Plot.Type)) + geom_violin(trim=FALSE, size=1)+
  theme_minimal()+ labs(y= expression(paste("count ", (kg^-1))), x = "")+
  geom_boxplot(width=0.1, size=1) + scale_color_hue(direction = -1) +
  theme(plot.title = element_text(hjust = 0.5)) + stat_summary(fun=mean, geom="point", size=1) + stat_summary(fun.data = mean_se, geom = "errorbar", aes(width=.02, size=.5))+
  theme(legend.position="none",legend.text=element_text(size=15),legend.direction='horizontal',plot.title = element_text(hjust=0.5),text=element_text(family="Arial"))+
  scale_x_discrete(labels= xaxis) +
  #annotate("text", x = 1, y = 330, label = "Warming > 0.05", size=20, family="Arial")+ 
  #annotate("text", x = 1, y = 315, label = "Soil Moisture < 0.05", size=20, family="Arial")+  
  #annotate("text", x = 1, y = 300, label = "Warming:Soil Moisture < 0.05", size=20, family="Arial")+
  theme(text=element_text(family="Arial"))

grid.arrange(Predators.violin.plot, Predators.effects.plot, ncol = 2, top = grid::textGrob("Predators", x = 0, hjust = 0, gp=gpar(fontfamily="Arial")))

```

